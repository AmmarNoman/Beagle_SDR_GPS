var gr={auto:1,dBm:0,db_units:"dB",speed:1,marker:1,threshold:0,max:0,min:0,hi:0,lo:0,goalH:0,goalL:0,scroll:0,scaleWidth:60,hysteresis:15,padding_tb:0,xi:0,secs_last:0,redraw_scale:!1,clr_color:"mediumBlue",bg_color:"ghostWhite",grid_color:"lightGrey",scale_color:"white",plot_color:"black"};function graph_init(r,g){gr.cv=r,gr.ct=r.ctx,gr.auto=1,gr.dBm=g.dBm||0,gr.dBm?(gr.padding_tb=20,gr.db_units="dBm"):(gr.db_units="dB",gr.padding_tb=0)}function graph_clear(){var r=gr.ct;r.fillStyle=gr.clr_color,r.fillRect(0,0,gr.cv.width-gr.scaleWidth,gr.cv.height),gr.xi=gr.cv.width-gr.scaleWidth,graph_rescale()}function graph_rescale(){gr.redraw_scale=!0}function graph_mode(r,g,l){gr.auto=r,gr.auto||(gr.max=g,gr.min=l),graph_rescale()}function graph_speed(r){gr.speed=r}function graph_marker(r){gr.marker=r}function graph_threshold(r){gr.threshold=r}function graph_plot(r){var g=gr.cv,l=gr.ct,e=g.width-gr.scaleWidth,a=g.height,i=e-gr.xi,o=gr.hi-gr.lo,t=function(r){var g=(r-gr.lo)/o;return a-g*a},c=function(r){return 10*Math.ceil(r/10)},d=!1;if(gr.redraw_scale||gr.auto){if(gr.auto){var s=.25/gr.speed;gr.goalH=gr.goalH>r+gr.padding_tb?gr.goalH-s:r+gr.padding_tb,gr.goalL=gr.goalL<r-gr.padding_tb?gr.goalL+s:r-gr.padding_tb}else gr.goalH=gr.max,gr.goalL=gr.min,d=!0;if(gr.goalL>gr.lo+gr.hysteresis||gr.goalL<gr.lo||d){var h=function(r){return 10*Math.floor(r/10)}(gr.goalL)-5,f=gr.hi-h;if(h<=gr.lo){var _=o/f;i&&(l.drawImage(g,gr.xi,0,i,a,gr.xi,0,i,a*_),l.fillStyle=gr.bg_color,l.fillRect(gr.xi,Math.floor(_*a),i,a*(1-_)+1))}else{var n=f/o;i&&l.drawImage(g,gr.xi,0,i,a*n,gr.xi,0,i,a)}gr.lo=h,o=f,gr.auto&&(gr.redraw_scale=!0)}if(gr.goalH>gr.hi||gr.goalH<gr.hi-gr.hysteresis||d){var u=c(gr.goalH)+5;f=u-gr.lo;if(u>=gr.hi){_=o/f;i&&(l.drawImage(g,gr.xi,0,i,a,gr.xi,a*(1-_),i,a*_),l.fillStyle=gr.bg_color,l.fillRect(gr.xi,0,i,Math.ceil(a*(1-_))))}else{n=f/o;i&&l.drawImage(g,gr.xi,a*(1-n),i,a*n,gr.xi,0,i,a)}gr.hi=u,o=u-gr.lo,gr.auto&&(gr.redraw_scale=!0)}}if(gr.redraw_scale){l.fillStyle=gr.clr_color,l.fillRect(e,0,gr.scaleWidth,a),l.fillStyle=gr.scale_color,l.font="10px Verdana";for(var p=gr.lo;(p=c(p))<=gr.hi;p++)l.fillText(p+" "+gr.db_units,e+2,t(p)+4,gr.scaleWidth);gr.redraw_scale=!1}if(++gr.scroll>=gr.speed){gr.scroll=0,gr.xi>0&&gr.xi--,l.drawImage(g,1,0,e-1,a,0,0,e-1,a);var m=(new Date).getTime()/1e3;if(Math.floor(m/gr.marker)==Math.floor(gr.secs_last/gr.marker)){l.fillStyle=gr.bg_color,l.fillRect(e-1,0,1,a),l.fillStyle=gr.grid_color;for(p=gr.lo;(p=c(p))<=gr.hi;p++)l.fillRect(e-1,t(p),1,1)}else gr.secs_last=m,l.fillStyle=gr.grid_color,l.fillRect(e-1,0,1,a);gr.threshold&&(l.fillStyle="red",l.fillRect(e-1,t(gr.threshold),1,1))}l.fillStyle=gr.plot_color,l.fillRect(e-1,t(r),1,1)}