var gr={auto:1,dBm:0,db_units:"dB",speed:1,marker:1,threshold:0,averaging:!1,avg_dB:0,max:0,min:0,hi:0,lo:0,goalH:0,goalL:0,scroll:0,scaleWidth:60,hysteresis:15,padding_tb:0,xi:0,secs_last:0,redraw_scale:!1,clr_color:"mediumBlue",bg_color:"ghostWhite",grid_color:"lightGrey",scale_color:"white",plot_color:"black"};function graph_init(r,g){gr.cv=r,gr.ct=r.ctx,gr.auto=1,gr.dBm=g.dBm||0,gr.speed=g.speed||1,gr.averaging=g.averaging||!1,gr.dBm?(gr.padding_tb=20,gr.db_units="dBm"):(gr.db_units="dB",gr.padding_tb=0)}function graph_clear(){var r=gr.ct;r.fillStyle=gr.clr_color,r.fillRect(0,0,gr.cv.width-gr.scaleWidth,gr.cv.height),gr.xi=gr.cv.width-gr.scaleWidth,graph_rescale()}function graph_rescale(){gr.redraw_scale=!0}function graph_mode(r,g,l){gr.auto=r,gr.auto||(gr.max=g,gr.min=l),graph_rescale()}function graph_speed(r){r<1&&(r=1),gr.speed=r}function graph_marker(r){gr.marker=r}function graph_threshold(r){gr.threshold=r}function graph_averaging(r){gr.averaging=r,gr.avg_dB=0}function graph_plot(r){var g=gr.cv,l=gr.ct,a=g.width-gr.scaleWidth,e=g.height,i=a-gr.xi,o=gr.hi-gr.lo,t=function(r){var g=(r-gr.lo)/o;return e-g*e},c=function(r){return 10*Math.ceil(r/10)},d=!1;if(gr.redraw_scale||gr.auto){if(gr.auto){var s=.25/gr.speed;gr.goalH=gr.goalH>r+gr.padding_tb?gr.goalH-s:r+gr.padding_tb,gr.goalL=gr.goalL<r-gr.padding_tb?gr.goalL+s:r-gr.padding_tb}else gr.goalH=gr.max,gr.goalL=gr.min,d=!0;if(gr.goalL>gr.lo+gr.hysteresis||gr.goalL<gr.lo||d){var h=function(r){return 10*Math.floor(r/10)}(gr.goalL)-5,n=gr.hi-h;if(h<=gr.lo){var _=o/n;i&&(l.drawImage(g,gr.xi,0,i,e,gr.xi,0,i,e*_),l.fillStyle=gr.bg_color,l.fillRect(gr.xi,Math.floor(_*e),i,e*(1-_)+1))}else{var f=n/o;i&&l.drawImage(g,gr.xi,0,i,e*f,gr.xi,0,i,e)}gr.lo=h,o=n,gr.auto&&(gr.redraw_scale=!0)}if(gr.goalH>gr.hi||gr.goalH<gr.hi-gr.hysteresis||d){var p=c(gr.goalH)+5;n=p-gr.lo;if(p>=gr.hi){_=o/n;i&&(l.drawImage(g,gr.xi,0,i,e,gr.xi,e*(1-_),i,e*_),l.fillStyle=gr.bg_color,l.fillRect(gr.xi,0,i,Math.ceil(e*(1-_))))}else{f=n/o;i&&l.drawImage(g,gr.xi,e*(1-f),i,e*f,gr.xi,0,i,e)}gr.hi=p,o=p-gr.lo,gr.auto&&(gr.redraw_scale=!0)}}if(gr.redraw_scale){l.fillStyle=gr.clr_color,l.fillRect(a,0,gr.scaleWidth,e),l.fillStyle=gr.scale_color,l.font="10px Verdana";for(var u=gr.lo;(u=c(u))<=gr.hi;u++)l.fillText(u+" "+gr.db_units,a+2,t(u)+4,gr.scaleWidth);gr.redraw_scale=!1}var v=!1;if(++gr.scroll>=gr.speed){gr.scroll=0,gr.xi>0&&gr.xi--,l.drawImage(g,1,0,a-1,e,0,0,a-1,e);var m=(new Date).getTime()/1e3;if(Math.floor(m/gr.marker)==Math.floor(gr.secs_last/gr.marker)){l.fillStyle=gr.bg_color,l.fillRect(a-1,0,1,e),l.fillStyle=gr.grid_color;for(u=gr.lo;(u=c(u))<=gr.hi;u++)l.fillRect(a-1,t(u),1,1)}else gr.secs_last=m,l.fillStyle=gr.grid_color,l.fillRect(a-1,0,1,e);gr.threshold&&(l.fillStyle="red",l.fillRect(a-1,t(gr.threshold),1,1)),v=!0}if(gr.averaging){var x=(gr.avg_dB*(gr.speed-1)+r)/gr.speed;r=gr.avg_dB=x}gr.averaging&&!v||(l.fillStyle=gr.plot_color,l.fillRect(a-1,t(r),1,1))}