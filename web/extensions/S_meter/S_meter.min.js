var S_meter={first_time:!0,ext_name:"S_meter",maxdb_init:-30,mindb_init:-130,speed_max:10,range:0,maxdb:0,mindb:0,speed:0,marker:0,div:0,xendx:0};function S_meter_main(){ext_switch_to_client(S_meter.ext_name,S_meter.first_time,S_meter_recv),S_meter.first_time||S_meter_controls_setup(),S_meter.first_time=!1}S_meter.maxdb=S_meter.maxdb_init,S_meter.mindb=S_meter.mindb_init,S_meter.speed=S_meter.speed_max;var sm_w=1024,sm_h=180,sm_padding=10,sm_tw=sm_w+2*sm_padding;function S_meter_recv(e){if("DAT"!=arrayBufferToStringLen(e,3))for(var _=arrayBufferToString(e).substring(4).split(" "),t=0;t<_.length;t++){var r=_[t].split("=");switch(r[0]){case"ready":S_meter_controls_setup();break;case"smeter":graph_plot(parseFloat(r[1]));break;default:console.log("S_meter_recv: UNKNOWN CMD "+r[0])}}else{var m=new Uint8Array(e,4),a=m[0],i=m.length-1;console.log("S_meter_recv: DATA UNKNOWN cmd="+a+" len="+i)}}function S_meter_controls_setup(){var e=time_display_html("S_meter")+w3_div("id-S_meter-data|left:150px; width:1044px; height:200px; background-color:mediumBlue; position:relative;",'<canvas id="id-S_meter-data-canvas" width="1024" height="180" style="position:absolute; padding: 10px;"></canvas>'),_=w3_div("id-S_meter-controls w3-text-white",w3_divs("w3-container/w3-tspace-8",w3_div("id-S_meter-info w3-medium w3-text-aqua","<b>S-meter graph</b>"),w3_select("","Range","","S_meter.range",S_meter.range,{0:"manual",1:"auto"},"S_meter_range_select_cb"),w3_div("id-S_meter-scale-sliders",w3_slider("","Scale max","S_meter.maxdb",S_meter.maxdb,-160,0,10,"S_meter_maxdb_cb"),w3_slider("","Scale min","S_meter.mindb",S_meter.mindb,-160,0,10,"S_meter_mindb_cb")),w3_slider("","Speed","S_meter.speed",S_meter.speed,1,S_meter.speed_max,1,"S_meter_speed_cb"),w3_inline("/w3-margin-between-16",w3_select("","Marker rate","","S_meter.marker",S_meter.marker,{0:"1 sec",1:"5 sec",2:"10 sec",3:"15 sec",4:"30 sec",5:"1 min"},"S_meter_marker_select_cb"),"w3-salign-end",w3_button("","Clear","S_meter_clear_cb"))));ext_panel_show(_,e,null),time_display_setup("S_meter"),S_meter.data=w3_el("id-S_meter-data"),S_meter.data_canvas=w3_el("id-S_meter-data-canvas"),S_meter.data_canvas.ctx=S_meter.data_canvas.getContext("2d"),graph_init(S_meter.data_canvas,{dBm:1}),graph_mode(S_meter_range==S_meter_range_e.AUTO?1:0,S_meter.maxdb,S_meter.mindb),S_meter_environment_changed({resize:1}),ext_set_controls_width_height(250),ext_send("SET run=1"),S_meter_update_interval=setInterval(function(){S_meter_update(0)},1e3),S_meter_update(1)}function S_meter_environment_changed(e){if(e.resize){var _,t=w3_el("id-S_meter-data"),r=(window.innerWidth-sm_tw-time_display_width())/2;if(w3_show_hide("S_meter-time-display",r>0),r>0)return _=sm_w,S_meter.data.style.width=px(_+2*sm_padding),S_meter.data_canvas.width=_,void(t.style.left=px(r));if((r=(window.innerWidth-sm_tw)/2)>0)return _=sm_w,S_meter.data.style.width=px(_+2*sm_padding),S_meter.data_canvas.width=_,void(t.style.left=px(r));_=window.innerWidth-30,console.log("shrink to "+_),S_meter.data.style.width=px(_),S_meter.data_canvas.width=_-2*sm_padding,t.style.left=px(15),S_meter_update(1)}}var S_meter_speed,S_meter_range=0,S_meter_range_e={MANUAL:0,AUTO:1};function S_meter_range_select_cb(e,_,t){t||((S_meter_range=+_)==S_meter_range_e.MANUAL?w3_show_block("id-S_meter-scale-sliders"):w3_hide("id-S_meter-scale-sliders"),graph_mode(S_meter_range==S_meter_range_e.AUTO?1:0,S_meter.maxdb,S_meter.mindb))}function S_meter_maxdb_cb(e,_,t){var r=+_;r=Math.max(S_meter.mindb,r),w3_num_cb(e,r.toString()),w3_set_label("Scale max "+r.toString()+" dBm",e),graph_mode(S_meter_range==S_meter_range_e.AUTO?1:0,S_meter.maxdb,S_meter.mindb)}function S_meter_mindb_cb(e,_,t){var r=+_;r=Math.min(r,S_meter.maxdb),w3_num_cb(e,r.toString()),w3_set_label("Scale min "+r.toString()+" dBm",e),graph_mode(S_meter_range==S_meter_range_e.AUTO?1:0,S_meter.maxdb,S_meter.mindb)}function S_meter_speed_cb(e,_,t){var r=+_;S_meter_speed=S_meter.speed_max-r+1,w3_num_cb(e,r.toString()),w3_set_label("Speed 1"+(1!=S_meter_speed?"/"+S_meter_speed.toString():""),e),graph_speed(S_meter_speed)}var S_meter_update_interval,sm_last_freq,sm_last_offset,S_meter_marker_e={SEC_1:0,SEC_5:1,SEC_10:2,SEC_15:3,SEC_30:4,MIN_1:5},S_meter_marker_sec=[1,5,10,15,30,60],S_meter_marker=S_meter_marker_sec[S_meter.marker];function S_meter_marker_select_cb(e,_){S_meter_marker=S_meter_marker_sec[+_],graph_marker(S_meter_marker)}function S_meter_clear_cb(e,_){graph_clear(),setTimeout(function(){w3_radio_unhighlight(e)},w3_highlight_time)}function S_meter_update(e){var _=ext_get_freq(),t=_-ext_get_carrier_freq();(e||_!=sm_last_freq)&&(graph_clear(),sm_last_freq=_,sm_last_offset=t)}function S_meter_blur(){ext_send("SET run=0"),kiwi_clearInterval(S_meter_update_interval)}function S_meter_config_html(){ext_admin_config(S_meter.ext_name,"S Meter",w3_div("id-S_meter w3-text-teal w3-hide","<b>S-meter graph configuration</b><hr>"))}