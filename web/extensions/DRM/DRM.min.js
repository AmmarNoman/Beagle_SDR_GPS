

/* web/extensions/DRM/DRM.min.js */
var drm={ext_name:"DRM",first_time:!0,active:!1,url:"http://DRM.kiwisdr.com/drm/",dseq:0,locked:0,wrong_srate:!1,n_menu:5,menu0:W3_SELECT_SHOW_TITLE,menu1:W3_SELECT_SHOW_TITLE,menu2:W3_SELECT_SHOW_TITLE,menu3:W3_SELECT_SHOW_TITLE,menu4:W3_SELECT_SHOW_TITLE,run:0,is_stopped:0,freq_s:"",freq:0,w_graph_nom:675,w_graph_min:400,panel_0:["info","info","info","info","info","info"],panel_1:["by-svc","graph","IQ","IQ","IQ","IQ"],SCHED0:0,GRAPH0:1,IQ_ALL:2,FAC:3,SDC:4,MSC:5,IQ_END:5,display_idx:1,display_s:{Schedule:[{m:"by service"}],Display:[{m:"IF/SNR",c:"graph"}],IQ:[{m:"all",c:"IQ"},{m:"FAC",c:"IQ"},{m:"SDC",c:"IQ"},{m:"MSC",c:"IQ"}]},stations:null,using_default:!1,loading_msg:"&nbsp;loading data from kiwisdr.com ...",SINGLE:0,MULTI:1,REGION:2,SERVICE:3,monitor:0,monitor_s:["DRM","source"],last_occ:-1,last_ilv:-1,last_sdc:-1,last_msc:-1,DRM_DAT_IQ:0,EAudCod:["AAC","OPUS","RESERVED","xHE_AAC",""],AAC:0,xHE_AAC:3,europe:{"BBC\\Worldservice":[3955,15620],"Radio\\France Intl":[3965,6175],"Voice of\\Russia":[5925,6025,6110,6125,7435,9590,9625,9800,11620,11860,15325],"Radio\\Romania Intl":[5940,5955,6025,6030,6040,6175,7220,7235,7350,9490,9820,13730],"Funklust\\(bitXpress)":[15785]},middle_east_africa:{"All India\\Radio":[6100,7550,9950],"Radio Kuwait":[11970,13650,15110,15540],"Voice of\\Nigeria":[15120]},asia_pac:{"China National\\Radio":[6030,7360,9420,9655,9870,11695,13825,15180,17770,17800,17830],"Radio\\New Zealand":[5975,7285,7330,9780,11690],"Transworld\\KTWR":[7500,11995,13800]},americas:{"WINB USA":[7315,9265,13690]},menu_India_MW:4,india_MW:{Ahmedabad:[855],Ajmer:[612],Bengaluru:[621],Barmer:[1467],Bikaner:[1404],"Chennai A":[729],"Chennai B":[783],Chinsurah:[603],"Delhi A":[828],"Delhi B":[1368],Dharwad:[774],Dibrugarh:[576],"Guwahati B":[1044],Hyderabad:[747],Itanagar:[684],Jabalpur:[810],Jalandhar:[882],Jammu:[999],"Kolkata A":[666],"Kolkata B":[1017],Luknow:[756],"Mumbai A":[1053],"Mumbai B":[567],Panaji:[1296],Passighat:[1071],Patna:[630],Pune:[801],"Rajkot A":[819],"Rajkot B":[1080],"Rajkot C":[1071],Ranchi:[558],Siliguri:[720],Suratgarh:[927],Tawang:[1530],Trichirapalli:[945],Varanasi:[1251],Vijayawada:[846]},last_last:0};function DRM_main(){ext_switch_to_client(drm.ext_name,drm.first_time,drm_recv),drm.first_time||drm_lock_setup(),drm.first_time=!1}function drm_recv(e){var r,d;if("DAT"!=arrayBufferToStringLen(e,3)){var t=arrayBufferToString(e).substring(4).split(" ");for(r=0;r<t.length;r++){var a=t[r].split("=");switch(a[0]){case"ready":kiwi_load_js(["pkgs/js/graph.js","pkgs/js/sprintf/sprintf.js"],"drm_lock_setup");break;case"locked":var s=+a[1];-1==s?(drm.wrong_srate=!0,drm.locked=0):kiwi.is_BBAI?(drm.drm_chan=s,drm.locked=s?0:1):drm.locked=s,drm_controls_setup();break;case"drm_status_cb":if(!drm.run||!drm.desktop)break;var i,n;try{i=decodeURIComponent(a[1])}catch(e){console.log("DRM decodeURIComponent(param) FAIL:"),console.log(e),console.log(a[1]);break}try{n=JSON.parse(i)}catch(e){console.log("DRM JSON.parse(deco) FAIL:"),console.log(e),console.log(i);break}drm_all_status(n.io,n.time,n.frame,n.FAC,n.SDC,n.MSC),w3_innerHTML("id-drm-if_level","IF Level: "+n.if.toFixed(1)+" dB"),n.if<0&&n.if>-100&&(isUndefined(drm.last_if)&&(drm.last_if=n.if),drm.last_if=graph_plot(n.if,{line:drm.last_if,color:"green"})),w3_innerHTML("id-drm-snr",n.snr?"SNR: "+n.snr.toFixed(1)+" dB":""),n.snr>0&&(isUndefined(drm.last_snr)&&(drm.last_snr=n.snr),drm.last_snr=graph_plot(n.snr,{line:drm.last_snr})),isDefined(n.mod)?((r=n.mod)>=0&&r<=3&&w3_color("id-drm-mod-"+["A","B","C","D"][r],"black","lime"),(r=n.occ)>=0&&r<=5&&(drm.last_occ!=r&&w3_color("id-drm-occ-"+["4.5","5","9","10","18","20"][drm.last_occ],"",""),w3_color("id-drm-occ-"+["4.5","5","9","10","18","20"][r],"black","lime"),drm.last_occ=r),(r=n.ilv)>=0&&r<=1&&(drm.last_ilv!=r&&w3_color("id-drm-ilv-"+["L","S"][drm.last_ilv],"",""),w3_color("id-drm-ilv-"+["L","S"][r],"black","lime"),drm.last_ilv=r),(r=n.sdc)>=0&&r<=1&&(drm.last_sdc!=r&&w3_color("id-drm-sdc-"+["4","16"][drm.last_sdc],"",""),w3_color("id-drm-sdc-"+["4","16"][r],"black","lime"),drm.last_sdc=r),(r=n.msc)>2&&(r=2),r>=1&&r<=2&&(drm.last_msc!=r&&w3_color("id-drm-msc-"+["16","64"][drm.last_msc-1],"",""),w3_color("id-drm-msc-"+["16","64"][r-1],"black","lime"),drm.last_msc=r),w3_innerHTML("id-drm-prot",sprintf("Protect: A=%d B=%d",n.pla,n.plb)),w3_innerHTML("id-drm-nsvc",sprintf("Services: A=%d D=%d",n.nas,n.nds)),n.mod>=0&&n.mod<=3&&w3_innerHTML("id-drm-desc",["Local/regional use","Medium range use, multipath resistant","Long distance use, multipath/doppler resistant","Resistance to large delay/doppler spread"][n.mod])):drm_reset_status(),w3_show_hide("id-drm-mode",isDefined(n.mod));var o=drm.AAC;n.svc.forEach(function(e,r){d=++r,e.id&&(d+=" "+drm.EAudCod[e.ac]+" ("+e.id+") "+e.lbl+(e.ep?" UEP ("+e.ep.toFixed(1)+"%) ":" EEP ")+(e.ad?"Audio ":"Data ")+e.br.toFixed(2)+" kbps");var t=w3_el("id-drm-svc-"+r);t.innerHTML=d,w3_color(t,null,e.cur?"mediumSlateBlue":""),e.cur&&e.ac<4&&(o=e.ac)}),w3_show("id-drm-svcs"),o!=drm.AAC&&console.log("codec="+o),w3_innerHTML("id-drm-error",o!=drm.AAC?"WARNING: "+(o==drm.xHE_AAC?"xHE_AAC ":"")+"codec not supported yet -- audio will be bad":"<br>"),w3_color("id-drm-error","white","red",o!=drm.AAC),n.msg&&w3_innerHTML("id-drm-msgs",n.msg);break;case"drm_bar_pct":if(!drm.run)break;var m=w3_clamp(parseInt(a[1]),0,100),_=w3_el("id-drm-bar");_&&(_.style.width=m+"%");break;case"annotate":switch(+a[1]){case 0:graph_annotate("lime");break;case 1:graph_annotate("gold");break;case 2:graph_annotate("red");break;case 3:graph_annotate("blue")}break;default:console.log("drm_recv: UNKNOWN CMD "+a[0])}}}else{var l=new Uint8Array(e,4)[0],c=new Uint8Array(e,5),w=c.length-1;if(isUndefined(drm.canvas_IQ))return;var p=drm.canvas_IQ.ctx,u=drm.w_IQ,h=drm.h_IQ;switch(l){case drm.DRM_DAT_IQ:if(p.fillStyle="white",p.fillRect(0,0,u,h),p.fillStyle="grey",p.fillRect(0,h/2,u,1),p.fillRect(u/2,0,1,h),drm.display==drm.IQ_ALL||drm.display==drm.FAC)for(p.fillStyle="green",r=0;r<64;r++){var f=c[2*r]/255*u,b=c[2*r+1]/255*h;p.fillRect(f,b,2,2)}if(r=64,drm.display==drm.IQ_ALL||drm.display==drm.SDC)for(p.fillStyle="red";r<320;r++){f=c[2*r]/255*u,b=c[2*r+1]/255*h;p.fillRect(f,b,2,2)}if(r=320,drm.display==drm.IQ_ALL||drm.display==drm.MSC)for(p.fillStyle="blue";r<2368;r++){f=c[2*r]/255*u,b=c[2*r+1]/255*h;p.fillRect(f,b,2,2)}return}console.log("drm_recv: DATA UNKNOWN cmd="+l+" len="+w)}}function drm_reset_status(){drm_all_status(4,4,4,4,4,4),w3_innerHTML("id-drm-if_level",""),w3_innerHTML("id-drm-snr",""),w3_hide("id-drm-mode");for(var e=0;e<=3;e++)w3_color("id-drm-mod-"+["A","B","C","D"][e],"","");w3_innerHTML("id-drm-error",""),w3_hide("id-drm-svcs"),w3_innerHTML("id-drm-msgs","")}function drm_status(e,r){var d;switch(r){case 0:d="lime";break;case 1:d="yellow";break;case 2:d="red";break;case 3:default:d="red";break;case 4:d="grey"}w3_color("id-drm-status-"+e,d)}function drm_all_status(e,r,d,t,a,s){drm_status("io",e),drm_status("time",r),drm_status("frame",d),drm_status("fac",t),drm_status("sdc",a),drm_status("msc",s)}function drm_lock_setup(){ext_send("SET lock_set")}function drm_saved_mode(){drm.saved_mode=ext_get_mode(),console.log("drm_save_mode FIRST saved_mode="+drm.saved_mode),"drm"==drm.saved_mode&&(drm.saved_mode=ext_get_prev_mode()),console.log("drm_save_mode FINAL saved_mode="+drm.saved_mode)}function drm_tscale(e){var r=drm.mobile?.3:.35,d=drm.mobile?.026:.025;return r*drm.w_sched+e*d*drm.w_sched}function drm_schedule_static(){for(var e="",r=0;r<=24;r++)e+=w3_div(sprintf("id-drm-sched-tscale|left:%fpx;",drm_tscale(r)));return e+=w3_div(sprintf("id-drm-sched-now|left:%fpx;",drm_tscale(kiwi_UTC_minutes()/60))),drm.interval=setInterval(function(){w3_el("id-drm-sched-now").style.left=px(drm_tscale(kiwi_UTC_minutes()/60))},6e4),e}function drm_set_freq_menu(e,r){r=isArg(r)?r.toLowerCase():null;for(var d=!1,t=0;t<drm.n_menu;t++){var a,s="drm.menu"+t;if(w3_select_enum(s,function(t){t.disabled&&(a=t.innerHTML.toLowerCase());var i=parseFloat(t.innerHTML);isNaN(i)||d||parseFloat(t.innerHTML)!=e||r&&!r.includes(a)||(drm_pre_select_cb(s,t.value,!1),d=!0)}),d)break}d||drm_set_freq(e)}function drm_click(e){var r=drm.stations[e];console.log("drm_click "+r.f+" "+dq(r.s.toLowerCase())),drm_set_freq_menu(r.f,r.s)}function drm_schedule(){if(drm.stations){var e,r=drm.using_default?w3_div("w3-yellow w3-padding w3-show-inline-block","can't contact kiwisdr.com<br>using default data"):"",d=drm.narrow_listing;for(e=0;e<drm.stations.length;e++){var t=drm.stations[e];if(t.t!=drm.REGION){for(var a=t.s,s=t.f,i="";e<drm.stations.length&&t.s==a&&t.f==s;){var n=drm_tscale(t.b),o=drm_tscale(t.e);i+=w3_div(sprintf('id-drm-sched-time|left:%fpx; width:%fpx;|onclick="drm_click(%d);"',n,o-n+2,e)),e++,t=drm.stations[e]}e--,a=a.replace("_",d?"<br>":" "),d&&(a=a.replace(",","<br>")),r+=w3_inline("cl-drm-sched-station cl-drm-sched-striped/",w3_div("",a+"&nbsp;&nbsp;&nbsp;"+(d?"<br>":"")+s),i),t&&t.t==drm.SERVICE&&(r+=w3_div("cl-drm-sched-hr-div cl-drm-sched-striped",'<hr class="cl-drm-sched-hr">'),e++)}}return r}}function drm_get_stations_cb(e){var r,d,t,a,s,i,n=!1;e?e.AJAX_error&&"timeout"==e.AJAX_error?(console.log("drm_get_stations_cb: TIMEOUT"),e=JSON.parse(drm.default_stations),drm.using_default=!0,n=!0):isArray(e)||(console.log("drm_get_stations_cb: not array"),n=!0):(console.log("drm_get_stations_cb: stations="+e),n=!0),n&&(console.log(e),console.log("drm_get_stations_cb: using default station list"),e=JSON.parse(drm.default_stations),drm.using_default=!0),drm.stations=[];var o=!1;e.forEach(function(e,n){i="",w3_obj_enum(e,function(n,m){var _=e[n];if(0==m)return"India MW"==(r=n)&&(i="India, ",o=!0),void drm.stations.push({t:drm.REGION,f:0,s:"",r:r});if(isArray(_)){for(d=i+n,m=0;m<_.length;m++){t=_[m++];var l=_[m];if(isArray(l))for(var c=0;c<l.length;c++)a=l[c++],s=l[c],drm.stations.push({t:drm.MULTI,f:t,s:d,r:r,b:a,e:s});else a=_[m++],s=_[m],drm.stations.push({t:drm.SINGLE,f:t,s:d,r:r,b:a,e:s})}o||drm.stations.push({t:drm.SERVICE,f:0,s:d,r:r})}})}),console.log(drm.stations),w3_innerHTML("id-drm-panel-by-svc",drm_schedule())}function drm_panel_show(e,r){var d=w3_div("id-drm-controls w3-text-white",w3_divs("w3-container/",w3_col_percent("",w3_div("w3-medium w3-text-aqua","<b>Digital Radio Mondiale (DRM30) decoder</b>"),60,w3_div("",'Based on <b><a href="https://sourceforge.net/projects/drm/" target="_blank">Dream 2.2.1</a></b>'),40),w3_col_percent("w3-margin-T-4/",w3_div("id-drm-station w3-text-css-yellow","&nbsp;"),60,w3_div("",'Schedules: <a href="https://www.drm.org/what-can-i-hear/broadcast-schedule-2/" target="_blank">drm.org</a> <a href="http://www.hfcc.org/drm" target="_blank">hfcc.org</a>'),40),e));ext_panel_show(d,r,null),ext_set_controls_width_height(700,150)}function drm_mobile_controls_setup(e){drm.mobile=1,console.log("$ mobile drm mobile_laptop_test="+mobile_laptop_test),drm.w_nom=drm.w_sched=300,drm.h_sched=mobile_laptop_test?100:230,drm.cpanel_margin=20;var r=w3_div(sprintf("id-drm-controls w3-absolute|width:%dpx; height:%dpx;",drm.w_sched,drm.h_sched),w3_div(sprintf("id-drm-panel-container cl-drm-sched|width:100%%; height:100%%;"),w3_div("id-drm-panel-by-svc-static",drm_schedule_static()),w3_div("id-drm-panel-by-svc w3-iphone-scroll w3-absolute|width:100%; height:100%;",drm.loading_msg)));ext_panel_show(r,null,null),ext_set_controls_width_height(drm.w_sched+drm.cpanel_margin,drm.h_sched+drm.cpanel_margin);var d=w3_el("id-ext-controls-close");console.log("DRM mobile setup panelShown="+w3_el("id-ext-controls").panelShown),d.onclick=function(){toggle_panel("ext-controls",0),console.log("DRM mobile ext-controls-close panelShown="+w3_el("id-ext-controls").panelShown)},w3_attribute("id-ext-controls-close-img","src","icons/close.black.24.png"),drm.last_mobile={},drm.rescale_cnt=drm.rescale_cnt2=0,drm.fit="",drm.interval2=setInterval(function(){if(e=ext_mobile_info(drm.last_mobile),drm.last_mobile=e,!e.orient_unchanged){drm.rescale_cnt++;var r=w3_el("id-control").uiWidth;drm.w_nom+r<=e.width?(drm.w_sched=e.width-r-60,w3_el("id-ext-controls").style.zIndex=125,drm.fit="sbs"+drm.w_sched):(drm.w_sched=e.width-2*drm.cpanel_margin,w3_el("id-ext-controls").style.zIndex=150,drm.fit="fw"+drm.w_sched),ext_set_controls_width_height(drm.w_sched+drm.cpanel_margin,drm.h_sched+drm.cpanel_margin),w3_el("id-drm-controls").style.width=px(drm.w_sched),w3_innerHTML("id-drm-panel-by-svc-static",drm_schedule_static()),w3_innerHTML("id-drm-panel-by-svc",drm_schedule())}},500)}function drm_desktop_controls_setup(e){var r,d=null,t=250;if(drm.wrong_srate)r=w3_text("w3-medium w3-text-css-yellow","Currently, DRM does not support Kiwis configured for 20 kHz wide channels.");else if(0==drm.locked)r=kiwi.is_BBAI?w3_text("w3-medium w3-text-css-yellow",sprintf("Limited to %d active instances.",drm.drm_chan)):w3_text("w3-medium w3-text-css-yellow","Requires exclusive use of the Kiwi.<br>While the DRM decoder is used there can be no other active connections.<br>Please try again when this is the only connection.");else{for(var a="Services:<br>",s=1;s<=4;s++)a+=w3_inline("",w3_checkbox("w3-margin-R-8","","drm.svc"+s,1==s,"drm_svcs_cbox_cb"),w3_div("id-drm-svc-"+s+"|width:100%"));var i=function(e){return e+" "+w3_icon("id-drm-status-"+e.toLowerCase(),"fa-square",16,"grey")+" &nbsp;&nbsp;"},n=function(e,r){return w3_span("id-drm-"+e+" cl-drm-blk",r)},o=function(e){return n("mod-"+e,e)},m=function(e){return n("occ-"+e,e)},_=function(e){return n("ilv-"+e,e)},l=function(e){return n("sdc-"+e,e)},c=function(e){return n("msc-"+e,e)},w=500+e;drm.w_sched=e;var p=25+w;d=time_display_html("drm")+w3_div(sprintf("id-drm-panel-0-info w3-relative w3-no-scroll|width:%dpx; height:%dpx; background-color:black;",p,t),w3_div(sprintf("id-drm-panel-graph w3-absolute|width:%dpx; height:%dpx; left:%dpx;",e,t,525),w3_div(sprintf("id-drm-panel-1-by-svc cl-drm-sched|width:%dpx; height:100%%;",e),w3_div("",drm_schedule_static()),w3_div("id-drm-panel-by-svc w3-scroll-y w3-absolute|width:100%; height:100%;",drm.loading_msg)),w3_canvas("id-drm-panel-1-graph",e,t,{padding:10}),w3_canvas("id-drm-panel-1-IQ",e,t,{padding:10})),w3_div(sprintf("id-drm-console-msg w3-margin-T-8 w3-small w3-text-white w3-absolute|left:%dpx; width:%dpx; height:%dpx; overflow-x:hidden;",25,500,t),w3_div("id-drm-status",i("IO")+i("Time")+i("Frame")+i("FAC")+i("SDC")+i("MSC")),w3_inline("w3-halign-space-between|width:250px/",w3_div("id-drm-if_level"),w3_div("id-drm-snr")),w3_divs("id-drm-mode w3-hide/w3-margin-T-6",w3_inline("/w3-show-inline","DRM mode ",o("A"),o("B"),o("C"),o("D"),"&nbsp;&nbsp;&nbsp; Chan ",m("4.5"),m("5"),m("9"),m("10"),m("18"),m("20")," kHz","&nbsp;&nbsp;&nbsp; ILV ",_("L"),_("S")),w3_inline("/w3-show-inline","SDC ",l("4"),l("16")," QAM","&nbsp;&nbsp;&nbsp; MSC ",c("16"),c("64")," QAM",w3_div("id-drm-prot w3-margin-left"),w3_div("id-drm-nsvc w3-margin-left")),w3_div("id-drm-desc")),w3_div("id-drm-error|width:"+px(450)),w3_div("id-drm-svcs w3-hide|width:"+px(450),a),"<br><br>",w3_div(sprintf("id-drm-msgs|width:%dpx",500))))+w3_div("id-drm-options w3-display-right w3-text-white|top:230px; right:0px; width:200px; height:200px",w3_select_hier("w3-text-red","","","drm.display_idx",drm.display_idx,drm.display_s,"drm_display_cb")),r=w3_inline("w3-halign-space-between w3-margin-T-8/",w3_select_hier("w3-text-red","Europe","select","drm.menu0",drm.menu0,drm.europe,"drm_pre_select_cb"),w3_select_hier("w3-text-red","Middle East, Africa","select","drm.menu1",drm.menu1,drm.middle_east_africa,"drm_pre_select_cb"),w3_select_hier("w3-text-red","Asia/Pacific","select","drm.menu2",drm.menu2,drm.asia_pac,"drm_pre_select_cb"),w3_select_hier("w3-text-red","Americas","select","drm.menu3",drm.menu3,drm.americas,"drm_pre_select_cb"),w3_select_hier("w3-text-red","India MW","select","drm.menu4",drm.menu4,drm.india_MW,"drm_pre_select_cb"))+w3_inline("w3-margin-T-8/w3-margin-between-16",w3_button("w3-padding-smaller","Next","drm_next_prev_cb",1),w3_button("w3-padding-smaller","Prev","drm_next_prev_cb",-1),w3_button("id-drm-stop-button w3-padding-smaller w3-pink","Stop","drm_stop_start_cb"),w3_button("w3-padding-smaller w3-css-yellow","Reset","drm_reset_cb"),w3_button("w3-padding-smaller w3-aqua","Test 1","drm_test_cb",1),w3_button("w3-padding-smaller w3-aqua","Test 2","drm_test_cb",2),w3_div("id-drm-bar-container w3-progress-container w3-round-large w3-white w3-hide|width:220px; height:16px",w3_div("id-drm-bar w3-progressbar w3-round-large w3-light-green|width:50%","&nbsp;")))}drm_panel_show(r,d),ext_set_data_height(t),0!=drm.locked&&(time_display_setup("drm"),drm.canvas_graph=w3_el("id-drm-panel-1-graph"),drm.canvas_graph.ctx=drm.canvas_graph.getContext("2d"),graph_init(drm.canvas_graph,{dBm:0,speed:1,averaging:!1}),graph_mode("auto"),graph_clear(),drm.canvas_IQ=w3_el("id-drm-panel-1-IQ"),drm.canvas_IQ.ctx=drm.canvas_IQ.getContext("2d"),drm.w_IQ=e-20,drm.h_IQ=230,drm.desktop=1)}function drm_controls_setup(){drm_saved_mode(),console.log("drm_controls_setup saved_mode="+drm.saved_mode),drm.saved_passband=ext_get_passband(),drm.is_stopped=0,console.log("drm_controls_setup is_stopped="+drm.is_stopped),(t=drm.url_params=ext_param())&&(t=t.split(",")).forEach(function(e,r){var d,t=e.split(":");if(t=t[t.length-1].toLowerCase(),(d=w3_ext_param("mobile",e)).match)drm.mobile=1;else if((d=w3_ext_param("debug",e)).match){var a=d.has_value?d.num:0;ext_send("SET debug="+a)}});var e=ext_mobile_info(),r=drm.w_graph_nom-Math.max(0,1440-e.width);if(drm.narrow_listing=r<drm.w_graph_nom,console.log("$ whg="+e.width+","+e.height+","+r),drm.mobile||r<=drm.w_graph_min?drm_mobile_controls_setup(e):drm_desktop_controls_setup(r),0!=drm.locked){if(drm.active=!0,drm.url_params){var d=parseFloat(drm.url_params);d&&drm_set_freq_menu(d)}var t;(t=drm.url_params)&&(t=t.split(",")).forEach(function(e,r){var d,t=e.split(":");if(t=t[t.length-1].toLowerCase(),w3_ext_param("help",e).match)extint_help_click();else if((d=w3_ext_param("test",e)).match){var a=d.has_value?d.num:1;drm_station("Test Recording "+(a=w3_clamp(a,1,2,1))),w3_show("id-drm-bar-container"),drm_test(a)}}),kiwi_ajax(drm.url+"stations.cjson","drm_get_stations_cb",0,1e4),drm_run(1),drm_set_freq(ext_get_freq_kHz())}}function drm_run(e){e!=drm.run&&(e&&(drm_saved_mode(),console.log("drm_run saved_mode="+drm.saved_mode),drm.saved_passband=ext_get_passband()),drm.run=e,ext_send("SET run="+drm.run))}function drm_test(e){ext_send("SET test="+e)}function drm_stop(){drm_test(0),drm_run(0),drm_reset_status(),drm_station(""),w3_hide("id-drm-bar-container"),isDefined(drm.saved_passband)&&ext_set_passband(drm.saved_passband.low,drm.saved_passband.high),isDefined(drm.saved_mode)&&(console.log("drm_stop RESTORE saved_mode="+drm.saved_mode),ext_set_mode(drm.saved_mode))}function drm_start(){drm_test(0),drm_run(1),ext_set_mode("drm"),drm.is_stopped=0,w3_button_text("id-drm-stop-button","Stop","w3-pink","w3-green")}function drm_stop_start_cb(e,r){console.log("drm_stop_start_cb ENTRY is_stopped="+drm.is_stopped),drm.is_stopped^=1,drm.is_stopped?(console.log("$drm_stop_start_cb: do stop, show start"),drm_stop(),w3_button_text(e,"Start","w3-green","w3-pink")):(console.log("$drm_stop_start_cb: do start, show stop"),drm_start())}function drm_set_freq(e){drm.freq=e;var r=ext_get_zoom();r<5?r=5:r>9&&(r=9),ext_tune(drm.freq,"drm",ext_zoom.ABS,r),ext_set_passband(-5e3,5e3),ext_tune(drm.freq,"drm",ext_zoom.ABS,r)}function drm_reset_cb(e,r,d){console.log("drm_reset_cb"),ext_send("SET reset")}function drm_test_cb(e,r,d){console.log("drm_test_cb "+r),drm_station("Test Recording "+r),drm_reset_menus(),drm_run(0),drm_start(),drm_test(r),ext_set_mode("drm"),w3_show("id-drm-bar-container"),graph_annotate("magenta")}function drm_svcs_cbox_cb(e,r,d){var t=e.substr(-1,1);if(!d){for(var a=1;a<=4;a++)w3_checkbox_set("drm.svc"+a,!1);w3_checkbox_set(e,!0),ext_send("SET svc="+t)}}function drm_monitor_cb(e,r,d){if(!d){var t=drm.monitor_s[r];console.log("drm_monitor_cb idx="+r+" monitor="+t),ext_send("SET monitor="+r)}}function drm_display_cb(e,r,d){r=+r,w3_select_value(e,r);var t=0,a=-1,s=!1;w3_select_enum(e,function(e){e.disabled||(s||e.value!=r||(a=t,s=!0),t++)});var i=drm.display=a;w3_color("id-drm-panel-graph",null,"graph"!=drm.panel_1[i]?"black":"mediumBlue"),console.log("$ drm_display_cb idx="+r+" show="+i+" "+drm.panel_0[i]+"/"+drm.panel_1[i]),drm.panel_0.forEach(function(e){w3_hide("id-drm-panel-0-"+e)}),drm.panel_1.forEach(function(e){w3_hide("id-drm-panel-1-"+e)}),w3_show("id-drm-panel-0-"+drm.panel_0[i]),w3_show("id-drm-panel-1-"+drm.panel_1[i]),ext_send("SET send_iq="+(i>=drm.IQ_ALL&&i<=drm.IQ_END?1:0))}function drm_reset_menus(){for(var e=0;e<drm.n_menu;e++)w3_select_value("drm.menu"+e,-1)}function drm_pre_select_cb(e,r,d){if(d)return!1;var t=!1;r=+r;var a=parseInt(e.split("drm.menu")[1]);return drm.last_disabled=!1,drm_reset_menus(),drm_station(""),w3_select_enum(e,function(d){d.disabled&&(0==drm.last_disabled&&(drm.station_id=[]),-1!=d.value&&drm.station_id.push(d.innerHTML)),drm.last_disabled=d.disabled,d.value==r&&(drm.freq_s=d.innerHTML,drm_set_freq(parseFloat(drm.freq_s)),w3_select_value(e,d.value),drm_station((a==drm.menu_India_MW?"India, ":"")+drm.station_id.join(" ")),drm_start(),t=!0)}),t}function drm_station(e){drm.desktop&&(drm.last_station=e,""==e&&(e="&nbsp;"),w3_el("id-drm-station").innerHTML="<b>"+e+"</b>",graph_annotate("magenta"))}function drm_environment_changed(e){var r=ext_get_freq()/1e3,d=ext_get_mode();if(drm.freq!=r||"drm"!=d){for(var t=0;t<drm.n_menu;t++)w3_select_value("drm.menu"+t,-1);drm.menu_sel="",drm_station("")}}function drm_next_prev_cb(e,r,d){r=+r;for(var t,a=0,s=0,i=0,n=0,o=0;o<drm.n_menu;o++){t="drm.menu"+o;var m=w3_el(t).value;if(-1!=m){w3_select_enum(t,function(e){e.disabled||(s&&(i=e.value,s=0),e.value===m&&(n=a,s=1),a=e.value)});break}}m=0,1==r&&i&&(m=i),-1==r&&n&&(m=n),m&&drm_pre_select_cb(t,m,!1)}function DRM_blur(){console.log("DRM_blur saved_mode="+drm.saved_mode),kiwi_clearInterval(drm.interval),kiwi_clearInterval(drm.interval2),drm.active=!1,drm_stop(),(isUndefined(drm.saved_mode)||"drm"==drm.saved_mode)&&(console.log("DRM_blur FORCE iq"),ext_set_mode("iq")),drm.locked=0,ext_send("SET lock_clear"),ext_set_data_height()}function DRM_help(e){if(e){var r=w3_text("w3-medium w3-bold w3-text-aqua","Digital Radio Mondiale (DRM30) decoder help")+"<br><br>"+w3_div("w3-scroll-y|height:85%",w3_text("w3-text-css-yellow w3-bold","Development in progress. Updates daily.")+'<br>With DRM selective fading can prevent even the strongest signals from being received properly. To see if signal fading is occurring adjust the waterfall "WF max/min" controls carefully so the waterfall colors are not saturated. The image below shows fading (dark areas) that might cause problems. See the <a href="http://valentfx.com/vanilla/discussion/1842/v1-360-drm-extension-now-available-for-beta-testing/p1" target="_blank">Kiwi forum</a> for more information. <br><br><img src="gfx/DRM.sel.fade.png" /><br><hr>DRM code from <b>Dream 2.2.1</b> <br>Technische Universitaet Darmstadt, Institut fuer Nachrichtentechnik <br>Copyright (c) 2001-2019 &nbsp;&nbsp;&nbsp;&nbsp;<a href="https://sourceforge.net/projects/drm" target="_blank">sourceforge.net/projects/drm</a> <br>License: GNU General Public License version 2.0 (GPLv2) <br><hr><b>Fraunhofer FDK AAC Codec Library for Android</b> <br>© Copyright  1995 - 2018 Fraunhofer-Gesellschaft zur Förderung der angewandten <br>Forschung e.V. All rights reserved. <br>For more information visit <a href="http://www.iis.fraunhofer.de/amm" target="_blank">www.iis.fraunhofer.de/amm</a> <br><hr><b>OpenCORE-AMR modifications to Fraunhofer FDK AAC Codec</b> <br>Copyright (C) 2009-2011 Martin Storsjo &nbsp;&nbsp;&nbsp;&nbsp;<a href="https://sourceforge.net/projects/opencore-amr" target="_blank">sourceforge.net/projects/opencore-amr</a> <br>License: Apache License V2.0 <br><hr>Features <b>NewsService Journaline(R)</b> decoder technology by <br>Fraunhofer IIS, Erlangen, Germany. <br>Copyright (c) 2003, 2004 <br>For more information visit <a href="http://www.iis.fhg.de/dab" target="_blank">www.iis.fhg.de/dab</a> <br>License: GNU General Public License version 2.0 (GPLv2) <br><hr>');confirmation_show_content(r,610,350),w3_el("id-confirmation-container").style.height="100%"}else if(drm.mobile)return"off";return!0}function DRM_config_html(){ext_config_html(drm,"DRM","DRM","DRM configuration")}drm.default_stations='[    {    "Europe": null,    "BBC_Worldservice": [3955,[6,7,9,10], 15620,8,9],    "Radio_France Intl": [3965,0,24, 6175,9,15],    "Voice of_Russia": [5925,21,23, 6025,[6,10,20,22], 6110,16,20, 6125,17,21, 7435,19,22, 9590,7,11, 9625,8,15, 9800,14,16, 11620,11,13, 11860,[0,1,22,24], 15325,1,6],    "Radio_Romania Intl": [5940,5.5,6, 5955,19,19.5, 6025,17,18, 6030,[16,16.5,21,22], 6040,[6,7,23,24], 6175,7,7.5, 7220,5,6, 7235,19,20, 7350,18,19, 9490,22,23, 9820,4,5, 13730,5,5.5],    "Funklust_(bitXpress)": [15785,0,24]    },    {    "Middle East, Africa": null,    "All India_Radio": [6100,8.75,12, 7550,17.75,19.75, 9950,[8.25,13.25,17.5,22.5]],    "Radio Kuwait": [11970,5,8, 13650,17,20, 15110,9.75,13.5, 15540,16,21],    "Voice of_Nigeria": [15120,16,19]    },        {    "Asia, Pacific": null,    "China National_Radio": [6030,[0,18,20.5,24], 7360,4,10, 9420,0,4, 9655,[0,1,8,12,22,24], 9870,10,12, 11695,1,9, 13825,1,9, 15180,[1,4,8,11], 17770,1,9, 17800,4,8, 17830,1,8],    "Radio_New Zealand": [5975,16.75,18, 7285,16.75,19, 7330,16.75,19, 9780,17.75,20, 11690,18.75,21],    "Transworld_KTWR": [7500,12.25,12.75, 11995,10.5,11, 13800,10.5,11]    },        {    "Americas": null,    "WINB USA": [7315,7,10, 9265,10,12, 13690,12,17]    },    {    "India MW": null,    "Ahmedabad": [855,0,24],    "Ajmer": [612,0,24],    "Bengaluru": [621,0,24],    "Barmer": [1467,0,24],    "Bikaner": [1404,0,24],    "Chennai A": [729,0,24],    "Chennai B": [783,0,24],    "Chinsurah": [603,0,24],    "Delhi A": [828,0,24],    "Delhi B": [1368,0,24],    "Dharwad": [774,0,24],    "Dibrugarh": [576,0,24],    "Guwahati B": [1044,0,24],    "Hyderabad": [747,0,24],    "Itanagar": [684,0,24],    "Jabalpur": [810,0,24],    "Jalandhar": [882,0,24],    "Jammu": [999,0,24],    "Kolkata A": [666,0,24],    "Kolkata B": [1017,0,24],    "Luknow": [756,0,24],    "Mumbai A": [1053,0,24],    "Mumbai B": [567,0,24],    "Panaji": [1296,0,24],    "Passighat": [1071,0,24],    "Patna": [630,0,24],    "Pune": [801,0,24],    "Rajkot A": [819,0,24],    "Rajkot B": [1080,0,24],    "Rajkot C": [1071,0,24],    "Ranchi": [558,0,24],    "Siliguri": [720,0,24],    "Suratgarh": [927,0,24],    "Tawang": [1530,0,24],    "Trichirapalli": [945,0,24],    "Varanasi": [1251,0,24],    "Vijayawada": [846,0,24]    },        {}]';